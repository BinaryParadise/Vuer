<html>

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0" />
    <script src="vue/vue@next.js"></script>
    <!-- import CSS -->
    <link rel="stylesheet" href="vue/index.css">
    <!-- import JavaScript -->
    <script src="vue/element-plus.js"></script>
    <link rel="stylesheet" href="css/light.css">
    <title>Element Plus demo</title>
</head>

<body>
    <div id="app">
        <el-menu mode="horizontal" @select="handleSelect">
            <el-sub-menu index="1">
                <template #title>工具中心</template>
                <el-menu-item index="1-1">日志浏览</el-menu-item>
                <el-menu-item index="1-2">WebSocket</el-menu-item>
            </el-sub-menu>
            <el-sub-menu index="2">
                <template #title>学习中心</template>
                <el-menu-item index="2-1">Vue Center</el-menu-item>
            </el-sub-menu>
        </el-menu>
        <el-row :style="'height:'+screenHeight+'px;padding:16px;'">
            <el-col>
                <el-tabs v-if="dynamicTabs.length > 0" v-model="activeTab" class="maintab" type="border-card" closable
                    @edit="handleTabsEdit" :style="'height:'+(screenHeight-40)+'px;'">
                    <el-tab-pane v-for="item in dynamicTabs" :key="item.name" :label="item.label" :name="item.name">
                        <div>a</div>
                    </el-tab-pane>
                </el-tabs>
            </el-col>
        </el-row>
    </div>
    <script>
        const App = {
            data() {
                return {
                    message: "Hello Element Plus",
                    screenHeight: document.body.clientHeight - 59,
                    menus: {
                        '1-1': '日志浏览',
                        '1-2': 'WebSocket',
                        '2-1': 'Vue Center'
                    },
                    activeTab: null,
                    dynamicTabs: []
                };
            },
            mounted: function () {
                const obj = this
                window.onresize = () => {
                    return (() => {
                        window.screenHeight = document.body.clientHeight - 59;
                        obj.screenHeight = window.screenHeight;
                    })()
                };
            },
            watch: {
                screenHeight(val) {
                    // 为了避免频繁触发resize函数导致页面卡顿，使用定时器
                    if (!this.timer) {
                        // 一旦监听到的screenWidth值改变，就将其重新赋给data里的screenWidth
                        this.screenHeight = val
                        this.timer = true
                        let that = this
                        setTimeout(function () {
                            // 打印screenWidth变化的值
                            console.log(that.screenHeight)
                            that.timer = false
                        }, 400)
                    }
                }
            },
            methods: {
                handleSelect: function (val) {
                    var curTab = { name: 'tab-' + val, label: this.menus[val] };
                    this.activeTab = curTab.name;
                    this.dynamicTabs.push(curTab);
                },
                handleTabsEdit: function (val) {
                    console.log(val);
                }
            }
        };
        const app = Vue.createApp(App);
        app.use(ElementPlus);
        app.mount("#app");
    </script>
</body>

</html>