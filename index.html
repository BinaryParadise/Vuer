<html>

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0" />
    <script src="vue/vue@next.js"></script>
    <!-- import CSS -->
    <link rel="stylesheet" href="vue/index.css">
    <!-- import JavaScript -->
    <script src="vue/element-plus.js"></script>
    <link rel="stylesheet" href="css/light.css">
    <title>Element Plus demo</title>
</head>

<body lang="zh-cn">
    <div id="app" lang="zh-cn">
        <el-container class="main-layout">
            <el-aside width="200px" style="height: 100vh;">
                <el-scrollbar>
                    <el-menu :default-openeds="['1', '2']" @select="handleSelect">
                        <el-sub-menu index="1">
                            <template #title>工具中心</template>
                            <el-menu-item index="1-1">日志浏览</el-menu-item>
                            <el-menu-item index="1-2">WebSocket</el-menu-item>
                        </el-sub-menu>
                        <el-sub-menu index="2">
                            <template #title>学习中心</template>
                            <el-menu-item index="2-1">Vue Center</el-menu-item>
                        </el-sub-menu>
                    </el-menu>
                </el-scrollbar>
            </el-aside>
            <el-container>
                <el-header>
                    <h1>标题</h1>
                </el-header>
                <el-main>
                    <el-row :style="'height:'+screenHeight+'px;padding:16px;'">
                        <el-col>
                            <el-tabs v-if="dynamicTabs.length > 0" v-model="activeTab" class="maintab"
                                type="border-card" closable @edit="handleTabsEdit"
                                :style="'height:'+(screenHeight-40)+'px;'">
                                <el-tab-pane v-for="item in dynamicTabs" :key="item.name" :label="item.label"
                                    :name="item.name">
                                    <el-row>
                                        <el-col>
                                            <el-pagination background layout="prev, pager, next" :total="1000" />
                                        </el-col>
                                        <el-col>
                                            <el-table :data="table.data" stripe border>
                                                <el-table-column prop="name" label="名称"></el-table-column>
                                            </el-table>
                                        </el-col>
                                        <el-col>
                                            <el-pagination background layout="prev, pager, next" :total="1000" />
                                        </el-col>
                                    </el-row>
                                </el-tab-pane>
                            </el-tabs>
                        </el-col>
                    </el-row>
                </el-main>
            </el-container>
        </el-container>
    </div>
    <script>
        const App = {
            data() {
                return {
                    table: {
                        data: Array.from(100).fill({ a: 1 }, 0)
                    },
                    message: "Hello Element Plus",
                    screenHeight: document.body.clientHeight - 59,
                    menus: {
                        '1-1': '日志浏览',
                        '1-2': 'WebSocket',
                        '2-1': 'Vue Center'
                    },
                    activeTab: null,
                    dynamicTabs: []
                };
            },
            mounted: function () {
                const obj = this
                for (let i = 0; i < 20; i++) {
                    this.table.data.push({ name: i });
                }
                window.onresize = () => {
                    return (() => {
                        window.screenHeight = document.body.clientHeight - 59;
                        obj.screenHeight = window.screenHeight;
                    })()
                };
            },
            watch: {
                screenHeight(val) {
                    // 为了避免频繁触发resize函数导致页面卡顿，使用定时器
                    if (!this.timer) {
                        // 一旦监听到的screenWidth值改变，就将其重新赋给data里的screenWidth
                        this.screenHeight = val
                        this.timer = true
                        let that = this
                        setTimeout(function () {
                            // 打印screenWidth变化的值
                            console.log(that.screenHeight)
                            that.timer = false
                        }, 400)
                    }
                }
            },
            methods: {
                handleSelect: function (val) {
                    var curTab = { name: 'tab-' + val, label: this.menus[val] };
                    this.activeTab = curTab.name;
                    if (this.dynamicTabs.filter(item => item.name == curTab.name).length == 0) {
                        this.dynamicTabs.push(curTab);
                    }
                },
                handleTabsEdit: function (val, action) {
                    if (action == "remove") {
                        var olds = this.dynamicTabs;
                        this.dynamicTabs = olds.filter(item => item.name != val);
                        if (val == this.activeTab) {
                            var old_idx = olds.indexOf(olds.filter(item => item.name == val)[0]);
                            this.activeTab = this.dynamicTabs[Math.min(this.dynamicTabs.length - 1, old_idx)].name;
                        }
                    }
                }
            }
        };
        const app = Vue.createApp(App);
        app.use(ElementPlus);
        app.mount("#app");
    </script>
</body>

</html>